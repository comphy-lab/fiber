<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <!-- Eliminate FOUC (Flash of Unstyled Content) and FOUT (Flash of Incorrect Theme) -->
  <script>
    (function() {
  try {
    // Apply the theme as quickly as possible to avoid flash
    let saved;
    try {
      saved = localStorage.getItem('theme');
    } catch (storageError) {
      // Handle localStorage access errors (private browsing, cookies disabled)
      console.warn('Unable to access localStorage:', storageError);
    }
    
    let prefersDark = false;
    try {
      prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    } catch (mediaError) {
      // Handle matchMedia access errors (unsupported browsers)
      console.warn('Unable to check media query:', mediaError);
    }
    
    const theme = saved ? saved : (prefersDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
    // Add theme class for CSS targeting
    document.documentElement.classList.add(theme + '-theme');
    // Mark when theme is set for CSS transitions
    document.documentElement.classList.add('theme-set');
  } catch (error) {
    // Fallback for any other unexpected errors
    console.warn('Theme initialization failed:', error);
    // Apply default theme as fallback
    try {
      document.documentElement.setAttribute('data-theme', 'light');
      document.documentElement.classList.add('light-theme');
      document.documentElement.classList.add('theme-set');
    } catch (fallbackError) {
      // Silent catch for extreme cases
      console.error('Critical theme fallback failed:', fallbackError);
    }
  }
})();
  </script>


  <!-- No-JS fallback for theme and critical theming styles -->
  <style>
    /* Default light theme variables */
    :root {
      /* Base colors */
      --color-background: #fff;
      --color-text: #333;
      --color-primary: #0066cc;
      --color-secondary: #036;
      --color-accent: #0099ff;
      
      /* UI elements */
      --color-header-bg: #f5f5f5;
      --color-footer-bg: #2d2e33;
      --color-border: #e0e0e0;
      --color-input-bg: #f9f9f9;
      
      /* Component colors */
      --color-preloader-bg: #ffffff;
      --color-loader: #0066cc;
      --color-card-bg: #ffffff;
      --color-code-bg: #f5f5f5;
    }
    
    /* Dark theme variables applied via media query when JS is disabled */
    @media (prefers-color-scheme: dark) {
      :root:not(.theme-set) {
        /* Base colors - dark mode */
        --color-background: #1a1a1a;
        --color-text: #f5f5f5;
        --color-primary: #4d9fff;
        --color-secondary: #88ccff;
        --color-accent: #00bfff;
        
        /* UI elements - dark mode */
        --color-header-bg: #121212;
        --color-footer-bg: #121212;
        --color-border: #333;
        --color-input-bg: #2d2d2d;
        
        /* Component colors - dark mode */
        --color-preloader-bg: #1a1a1a;
        --color-loader: #4d9fff;
        --color-card-bg: #222;
        --color-code-bg: #2d2d2d;
      }
    }
    
    /* When JS sets the theme explicitly via data attribute */
    [data-theme="dark"] {
      /* Base colors - dark mode */
      --color-background: #1a1a1a;
      --color-text: #f5f5f5;
      --color-primary: #4d9fff;
      --color-secondary: #88ccff;
      --color-accent: #00bfff;
      
      /* UI elements - dark mode */
      --color-header-bg: #121212;
      --color-footer-bg: #121212;
      --color-border: #333;
      --color-input-bg: #2d2d2d;
      
      /* Component colors - dark mode */
      --color-preloader-bg: #1a1a1a;
      --color-loader: #4d9fff;
      --color-card-bg: #222;
      --color-code-bg: #2d2d2d;
    }
    
    /* Prevent transition flashes during initial load */
    html:not(.transitions-enabled) * {
      transition: none !important;
    }
    
    /* Apply theme to preloader and early elements */
    #preloader {
      background-color: var(--color-preloader-bg);
      color: var(--color-text);
    }
    
    #loader {
      border-color: var(--color-loader);
      border-top-color: transparent;
    }
    
    /* Noscript warning */
    .noscript-warning {
      background-color: var(--color-primary);
      color: white;
      text-align: center;
      padding: 10px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }
    
    /* Theme indicator for no-JS */
    .theme-indicator {
      padding: 5px 10px;
      border-radius: 4px;
      background-color: var(--color-input-bg);
      color: var(--color-text);
      text-align: center;
    }
    
    /* Hide JS-only elements when no JS */
    .no-js .js-only {
      display: none !important;
    }
    
    /* Show no-JS alternatives */
    .js .no-js-only {
      display: none !important;
    }
  </style>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="base-url" content="..">
  <title>postProcess/VideoAxi.py | Documentation</title>
  
  <!-- Critical CSS for fastest paint -->
  <style>
      .s-intro__title {
          visibility: visible;
          font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      .s-header {
          visibility: visible;
      }
      
      /* Ensure theme toggle properly styled immediately */
      .theme-toggle {
          background-color: var(--color-background);
          color: var(--color-text);
      }
      
      /* Control SVG visibility based on theme */
      [data-theme="dark"] .theme-toggle-icon.sun,
      :root:not([data-theme="dark"]) .theme-toggle-icon.moon {
          display: block;
      }
      
      [data-theme="dark"] .theme-toggle-icon.moon,
      :root:not([data-theme="dark"]) .theme-toggle-icon.sun {
          display: none;
      }
  </style>

  <!-- Critical Meta Tags -->
  <meta name="description" content="Viscoelastic Visualization Tool =========================================== This script processes and visualizes fluid dynamics simulation data, particularly...">
  <meta name="author" content="CoMPhy Lab">
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="gettingfacets, gettingfield, main, process_timestep, that, videoaxi, with">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-title" content="CoMPhy Lab">

  <!-- Preload critical resources -->
  <link rel="preload" href="../assets/js/main.js" as="script">
  <link rel="preload" href="../assets/css/fontello/css/fontello.css" as="style">
  <link rel="preload" href="../assets/css/academicons-1.7.0/css/academicons.min.css" as="style">

  <!-- Base stylesheets -->
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="stylesheet" href="../assets/css/custom_styles.css">
  <link rel="stylesheet" href="../assets/css/command-palette.css">
  <link rel="stylesheet" href="../assets/css/fontello/css/fontello.css">
  <link rel="stylesheet" href="../assets/css/academicons-1.7.0/css/academicons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">

  <!-- Font optimization -->
  <style>
      @font-face {
          font-display: swap;
          font-family: 'System Font';
          src: local('system-ui');
      }
  </style>

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../assets/favicon/favicon-96x96.png">
  <link rel="icon" type="image/svg+xml" href="../assets/favicon/favicon.svg">
  <link rel="shortcut icon" href="../assets/favicon/favicon.ico">
  <link rel="manifest" href="../assets/favicon/site.webmanifest">

  <!-- Scripts with proper loading attributes -->
  <script src="../assets/js/jquery.min.js"></script>
  <script src="../assets/js/jquery-ui.packed.js"></script>
  <script src="../assets/js/plots.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
  <!-- Config script must load before other scripts -->
  <script src="../assets/js/config.js"></script>
  <script defer src="../assets/js/search-helper.js"></script>
  <script defer src="../assets/js/command-palette.js"></script>
  <script defer src="../assets/js/command-data.js"></script>
  <script defer src="../assets/js/main.js"></script>
  <script defer src="../assets/js/theme-toggle.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>
  
  <!-- Optimize page load performance -->
  <script>
    // Preconnect to critical domains
    const preconnectDomains = [
      'https://cdnjs.cloudflare.com',
      'https://cdn.jsdelivr.net'
    ];
    
    preconnectDomains.forEach(domain => {
      const link = document.createElement('link');
      link.rel = 'preconnect';
      link.href = domain;
      link.crossOrigin = 'anonymous';
      document.head.appendChild(link);
      
      // Also add DNS prefetch as fallback
      const dnsLink = document.createElement('link');
      dnsLink.rel = 'dns-prefetch';
      dnsLink.href = domain;
      document.head.appendChild(dnsLink);
    });
    
    // Detect when document is fully loaded to remove preloader
    window.addEventListener('load', function() {
      const preloader = document.getElementById('preloader');
      if (preloader) {
        preloader.style.opacity = '0';
        setTimeout(() => {
          preloader.style.display = 'none';
        }, 300); // Match transition duration
      }
    });
  </script>

  <script>
      // Load Font Awesome with proper environment detection and fallbacks
      function loadStylesheet(href) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = href;
        link.crossOrigin = 'anonymous';
        link.onerror = (e) => {
          console.error(`Failed to load stylesheet: `, e);
          console.log('Trying alternative Font Awesome source...');
        };
        document.head.appendChild(link);
        return link;
      }
      
      // Check if we're on localhost
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        // Use hardcoded version numbers for reliable loading
        
        // Load Font Awesome using multiple CDNs to maximize reliability for local development
        loadStylesheet('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css');
        // Backup CDN if the first one fails
        loadStylesheet('https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css');
        // Final local fallback - ensures it will work on any localhost environment
        loadStylesheet('https://use.fontawesome.com/releases/v6.7.2/css/all.css');
      } else {
        // Use Kit for production with defer
        var script = document.createElement('script');
        script.src = 'https://kit.fontawesome.com/b1cfd9ca75.js';
        script.crossOrigin = 'anonymous';
        script.defer = true;
        document.head.appendChild(script);
      }
    </script>

  <script>
      // Mark page as JS-enabled and manage transitions
      document.documentElement.classList.remove('no-js');
      document.documentElement.classList.add('js');
      
      // Allow CSS transitions after initial load to prevent transition flashes
      window.addEventListener('DOMContentLoaded', () => {
          setTimeout(() => {
              document.documentElement.classList.add('transitions-enabled');
          }, 100); // Short delay to ensure DOM is ready
      });
  </script>
</head>
<body id="top">
<script>window.repoName = "fiber";</script>


    <!-- Preloader with theme variables applied -->
    <div id="preloader">
        <div id="loader"></div>
    </div>

    <noscript>
        <div class="noscript-warning">
            <p>This site works best with JavaScript enabled. Some features may be limited.</p>
        </div>
    </noscript>

    <div id="page" class="s-pagewrap">
        <header class="s-header">
            <div class="s-header__logo">
                <a class="logo" href="/">
                    <img src="../assets/logos/CoMPhy-Lab-no-name.png" alt="CoMPhy Lab">
                </a>
                <a class="documentation-button" href="/fiber">
                    <i class="fa-solid fa-book-open"></i>
                    <span>fiber</span>
                </a>
            </div>
            <a class="s-header__menu-toggle" href="#0">
                <span class="s-header__menu-text">Menu</span>
                <span class="s-header__menu-icon"></span>
            </a>
            <nav class="s-header__nav">
                <a href="#0" class="s-header__nav-close-btn"><span>Close</span></a>
                <ul class="s-header__nav-list">
                    <li style="background: none;">
                        <!-- JS theme toggle -->
                        <div class="theme-toggle js-only" id="theme-toggle" aria-label="Toggle dark/light theme">
                            <svg class="theme-toggle-icon moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                            <svg class="theme-toggle-icon sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                        </div>
                    </li>
                    <li style="background: none;"><a href="https://scholar.google.com/citations?user=tHb_qZoAAAAJ&hl=en" style="background: none; padding: 0;" aria-label="Google Scholar Profile"><i class="ai ai-google-scholar" style="font-size: 1.75em;"></i></a></li>
                    <li style="background: none;"><a href="https://github.com/comphy-lab" style="background: none; padding: 0;" aria-label="GitHub Organization"><i class="fa-brands fa-github" style="font-size: 1.75em"></i></a></li>
                    <li><a href="https://comphy-lab.org/#about" class="smoothscroll">About</a></li>
                    <li><a href="https://comphy-lab.org/team/">Team</a></li>
                    <li><a href="https://comphy-lab.org/research">Research</a></li>
                    <li><a href="https://comphy-lab.org/teaching">Teaching</a></li>
                    <li><a href="https://comphy-lab.org/join">Join Us</a></li>
                    <li><a href="https://blogs.comphy-lab.org/">Blog</a></li>
                    <li style="background: none;"><a href="https://bsky.app/profile/comphy-lab.org" style="background: none; padding: 0;" aria-label="Bluesky Profile"><i class="fa-brands fa-bluesky" style="font-size: 1.75em; color: #0085ff;"></i></a></li>
                    <!-- Command Palette Button (Styled like search) -->
                    <li class="command-palette-button">
                        <div class="command-wrapper">
                            <button class="command-k-style-btn" id="command-palette-btn" aria-label="Open command palette">
                                <span class="default-theme-text">ctrl K</span>
                                <span class="mac-theme-text">⌘ K</span>
                                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                            </button>
                        </div>
                    </li>
                </ul>
            </nav>
        </header>

        <!-- Main content -->
        <main class="content">
            
            <div class="page-content">
                
                                <h1 class="page-title">postProcess/VideoAxi.py</h1>
                
                                
                                <div class="raw-file-button-container">
                    <a href="https://github.com/comphy-lab/fiber/raw/main/postProcess/VideoAxi.py" class="raw-file-button" target="_blank">
                        <i class="fa-brands fa-github"></i> See raw file
                    </a>
                </div>
                
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><span class="co">#!/usr/bin/env python3</span></span>
<span id="cb1-2"><span class="co"># -*- coding: utf-8 -*-</span></span></code></pre></div></div>
                <h1 id="viscoelastic-visualization-tool">Viscoelastic
                Visualization Tool</h1>
                <p>This script processes and visualizes fluid dynamics
                simulation data, particularly focused on droplet impact
                and deformable soft matter like liquid drops, sheets,
                and bubbles. It extracts interface positions and scalar
                field data from simulation files and creates
                visualizations showing physical quantities like strain
                rates and stresses.</p>
                <p>The script is designed to process multiple simulation
                snapshots in parallel, extracting data using external
                executables and generating visualizations with proper
                colormaps, scales, and mathematical labels.</p>
                <p>Features: - Extracts fluid interfaces and scalar
                fields from simulation files - Generates visualizations
                with proper colormaps and mathematical labels -
                Processes multiple timesteps in parallel using
                multiprocessing - Configurable via command-line
                arguments for different simulation cases - Creates
                publication-quality figures with LaTeX-rendered
                mathematical expressions</p>
                <p>Usage: python fluid_vis.py [options]</p>
                <p>Command-line Arguments: –CPUs Number of CPUs to use
                for parallel processing (default: all available) –nGFS
                Number of restart files to process (default: 550) –ZMAX
                Maximum Z coordinate for visualization (default: 4.0)
                –RMAX Maximum R coordinate for visualization (default:
                2.0) –ZMIN Minimum Z coordinate for visualization
                (default: -4.0) –caseToProcess Path to simulation case
                directory (default: ‘../simulationCases/dropImpact’)
                –folderToSave Directory to save visualization images
                (default: ‘dropImpact’)</p>
                <p>Dependencies: External executables: getFacet2D,
                getData-elastic-scalar2D Python libraries: numpy,
                matplotlib, subprocess, multiprocessing</p>
                <p>Author: Vatsal Sanjay Email: vatsalsanjay@gmail.com
                Affiliation: Physics of Fluids Last updated: Jul 24,
                2024</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><span class="im">import</span> os</span>
<span id="cb2-3"><span class="im">import</span> subprocess <span class="im">as</span> sp</span>
<span id="cb2-4"><span class="im">import</span> matplotlib</span>
<span id="cb2-5"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-6"><span class="im">from</span> matplotlib.collections <span class="im">import</span> LineCollection</span>
<span id="cb2-7"><span class="im">from</span> matplotlib.ticker <span class="im">import</span> StrMethodFormatter</span>
<span id="cb2-8"><span class="im">import</span> multiprocessing <span class="im">as</span> mp</span>
<span id="cb2-9"><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb2-10"><span class="im">import</span> argparse</span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb2-13">custom_colors <span class="op">=</span> [<span class="st">&quot;white&quot;</span>, <span class="st">&quot;#DA8A67&quot;</span>, <span class="st">&quot;#A0522D&quot;</span>, <span class="st">&quot;#400000&quot;</span>]</span>
<span id="cb2-14">custom_cmap <span class="op">=</span> mcolors.LinearSegmentedColormap.from_list(<span class="st">&quot;custom_hot&quot;</span>, custom_colors)</span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="co"># Configure matplotlib for publication-quality figures with LaTeX rendering</span></span>
<span id="cb2-17">matplotlib.rcParams[<span class="st">&#39;font.family&#39;</span>] <span class="op">=</span> <span class="st">&#39;serif&#39;</span></span>
<span id="cb2-18">matplotlib.rcParams[<span class="st">&#39;text.usetex&#39;</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb2-19">matplotlib.rcParams[<span class="st">&#39;text.latex.preamble&#39;</span>] <span class="op">=</span> <span class="vs">r&#39;</span><span class="er">\</span><span class="vs">usepackage{amsmath}&#39;</span></span>
<span id="cb2-20"></span>
<span id="cb2-21"><span class="kw">def</span> gettingFacets(filename, includeCoat<span class="op">=</span><span class="st">&#39;true&#39;</span>):</span></code></pre></div></div>
                <p>Extract interface positions (facets) from simulation
                files.</p>
                <p>Args: filename (str): Path to simulation snapshot
                file includeCoat (str, optional): Whether to include
                coating layer. Defaults to ‘true’.</p>
                <p>Returns: list: List of line segments defining fluid
                interfaces</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode python"><code class="sourceCode python"><span id="cb3-1">    exe <span class="op">=</span> [<span class="st">&quot;./getFacet2D&quot;</span>, filename, includeCoat]</span>
<span id="cb3-2">    p <span class="op">=</span> sp.Popen(exe, stdout<span class="op">=</span>sp.PIPE, stderr<span class="op">=</span>sp.PIPE)</span>
<span id="cb3-3">    stdout, stderr <span class="op">=</span> p.communicate()</span>
<span id="cb3-4">    temp1 <span class="op">=</span> stderr.decode(<span class="st">&quot;utf-8&quot;</span>)</span>
<span id="cb3-5">    temp2 <span class="op">=</span> temp1.split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-6">    segs <span class="op">=</span> []</span>
<span id="cb3-7">    skip <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-8">    <span class="cf">if</span> (<span class="bu">len</span>(temp2) <span class="op">&gt;</span> <span class="fl">1e2</span>):</span>
<span id="cb3-9">        <span class="cf">for</span> n1 <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(temp2)):</span>
<span id="cb3-10">            temp3 <span class="op">=</span> temp2[n1].split(<span class="st">&quot; &quot;</span>)</span>
<span id="cb3-11">            <span class="cf">if</span> temp3 <span class="op">==</span> [<span class="st">&#39;&#39;</span>]:</span>
<span id="cb3-12">                skip <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-13">                <span class="cf">pass</span></span>
<span id="cb3-14">            <span class="cf">else</span>:</span>
<span id="cb3-15">                <span class="cf">if</span> <span class="kw">not</span> skip:</span>
<span id="cb3-16">                    temp4 <span class="op">=</span> temp2[n1<span class="op">+</span><span class="dv">1</span>].split(<span class="st">&quot; &quot;</span>)</span>
<span id="cb3-17">                    r1, z1 <span class="op">=</span> np.array([<span class="bu">float</span>(temp3[<span class="dv">1</span>]), <span class="bu">float</span>(temp3[<span class="dv">0</span>])])</span>
<span id="cb3-18">                    r2, z2 <span class="op">=</span> np.array([<span class="bu">float</span>(temp4[<span class="dv">1</span>]), <span class="bu">float</span>(temp4[<span class="dv">0</span>])])</span>
<span id="cb3-19">                    segs.append(((r1, z1),(r2, z2)))</span>
<span id="cb3-20">                    segs.append(((<span class="op">-</span>r1, z1),(<span class="op">-</span>r2, z2)))</span>
<span id="cb3-21">                    skip <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-22">    <span class="cf">return</span> segs</span>
<span id="cb3-23"></span>
<span id="cb3-24"><span class="kw">def</span> gettingfield(filename, zmin, zmax, rmax, nr):</span></code></pre></div></div>
                <p>Extract scalar field data from simulation files.</p>
                <p>Args: filename (str): Path to simulation snapshot
                file zmin (float): Minimum Z coordinate zmax (float):
                Maximum Z coordinate rmax (float): Maximum R coordinate
                nr (int): Number of grid points in R direction</p>
                <p>Returns: tuple: (R, Z, D2, vel, taup, nz) arrays of
                coordinates and field values</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode python"><code class="sourceCode python"><span id="cb4-1">    exe <span class="op">=</span> [<span class="st">&quot;./getData-elastic-scalar2D&quot;</span>, filename, <span class="bu">str</span>(zmin), <span class="bu">str</span>(<span class="dv">0</span>), <span class="bu">str</span>(zmax), <span class="bu">str</span>(rmax), <span class="bu">str</span>(nr)]</span>
<span id="cb4-2">    p <span class="op">=</span> sp.Popen(exe, stdout<span class="op">=</span>sp.PIPE, stderr<span class="op">=</span>sp.PIPE)</span>
<span id="cb4-3">    stdout, stderr <span class="op">=</span> p.communicate()</span>
<span id="cb4-4">    temp1 <span class="op">=</span> stderr.decode(<span class="st">&quot;utf-8&quot;</span>)</span>
<span id="cb4-5">    temp2 <span class="op">=</span> temp1.split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-6">    <span class="co"># print(temp2) #debugging</span></span>
<span id="cb4-7">    Rtemp, Ztemp, D2temp, veltemp, taupTemp  <span class="op">=</span> [],[],[],[],[]</span>
<span id="cb4-8"></span>
<span id="cb4-9">    <span class="cf">for</span> n1 <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(temp2)):</span>
<span id="cb4-10">        temp3 <span class="op">=</span> temp2[n1].split(<span class="st">&quot; &quot;</span>)</span>
<span id="cb4-11">        <span class="cf">if</span> temp3 <span class="op">==</span> [<span class="st">&#39;&#39;</span>]:</span>
<span id="cb4-12">            <span class="cf">pass</span></span>
<span id="cb4-13">        <span class="cf">else</span>:</span>
<span id="cb4-14">            Ztemp.append(<span class="bu">float</span>(temp3[<span class="dv">0</span>]))</span>
<span id="cb4-15">            Rtemp.append(<span class="bu">float</span>(temp3[<span class="dv">1</span>]))</span>
<span id="cb4-16">            D2temp.append(<span class="bu">float</span>(temp3[<span class="dv">2</span>]))</span>
<span id="cb4-17">            veltemp.append(<span class="bu">float</span>(temp3[<span class="dv">3</span>]))</span>
<span id="cb4-18">            taupTemp.append(<span class="bu">float</span>(temp3[<span class="dv">4</span>]))</span>
<span id="cb4-19"></span>
<span id="cb4-20">    R <span class="op">=</span> np.asarray(Rtemp)</span>
<span id="cb4-21">    Z <span class="op">=</span> np.asarray(Ztemp)</span>
<span id="cb4-22">    D2 <span class="op">=</span> np.asarray(D2temp)</span>
<span id="cb4-23">    vel <span class="op">=</span> np.asarray(veltemp)</span>
<span id="cb4-24">    taup <span class="op">=</span> np.asarray(taupTemp)</span>
<span id="cb4-25">    nz <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Z)<span class="op">/</span>nr)</span>
<span id="cb4-26"></span>
<span id="cb4-27">    <span class="co"># print(&quot;nr is %d %d&quot; % (nr, len(R))) # debugging</span></span>
<span id="cb4-28">    <span class="bu">print</span>(<span class="st">&quot;nz is </span><span class="sc">%d</span><span class="st">&quot;</span> <span class="op">%</span> nz)</span>
<span id="cb4-29"></span>
<span id="cb4-30">    R.resize((nz, nr))</span>
<span id="cb4-31">    Z.resize((nz, nr))</span>
<span id="cb4-32">    D2.resize((nz, nr))</span>
<span id="cb4-33">    vel.resize((nz, nr))</span>
<span id="cb4-34">    taup.resize((nz, nr))</span>
<span id="cb4-35"></span>
<span id="cb4-36">    <span class="cf">return</span> R, Z, D2, vel, taup, nz</span>
<span id="cb4-37"><span class="co"># ----------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb4-38"></span>
<span id="cb4-39"><span class="kw">def</span> process_timestep(ti, folder, nGFS, GridsPerR, rmin, rmax, zmin, zmax, lw, caseToProcess):</span></code></pre></div></div>
                <p>Process a single timestep from simulation data and
                generate visualization.</p>
                <p>Args: ti (int): Timestep index folder (str):
                Directory to save output images nGFS (int): Total number
                of timesteps GridsPerR (int): Grid points per unit
                length in R direction rmin (float): Minimum R coordinate
                rmax (float): Maximum R coordinate zmin (float): Minimum
                Z coordinate zmax (float): Maximum Z coordinate lw
                (float): Line width for plot elements caseToProcess
                (str): Path to simulation case directory</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode python"><code class="sourceCode python"><span id="cb5-1">    t <span class="op">=</span> <span class="fl">0.01</span> <span class="op">*</span> ti</span>
<span id="cb5-2">    place <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>caseToProcess<span class="sc">}</span><span class="ss">/intermediate/snapshot-</span><span class="sc">{</span>t<span class="sc">:.4f}</span><span class="ss">&quot;</span></span>
<span id="cb5-3">    name <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">int</span>(t<span class="op">*</span><span class="dv">1000</span>)<span class="sc">:08d}</span><span class="ss">.png&quot;</span></span>
<span id="cb5-4"></span>
<span id="cb5-5">    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(place):</span>
<span id="cb5-6">        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>place<span class="sc">}</span><span class="ss"> File not found!&quot;</span>)</span>
<span id="cb5-7">        <span class="cf">return</span></span>
<span id="cb5-8"></span>
<span id="cb5-9">    <span class="cf">if</span> os.path.exists(name):</span>
<span id="cb5-10">        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> Image present!&quot;</span>)</span>
<span id="cb5-11">        <span class="cf">return</span></span>
<span id="cb5-12"></span>
<span id="cb5-13">    segs1 <span class="op">=</span> gettingFacets(place)</span>
<span id="cb5-14">    segs2 <span class="op">=</span> gettingFacets(place, <span class="st">&#39;false&#39;</span>)</span>
<span id="cb5-15"></span>
<span id="cb5-16">    <span class="cf">if</span> <span class="kw">not</span> segs1 <span class="kw">and</span> <span class="kw">not</span> segs2:</span>
<span id="cb5-17">        <span class="bu">print</span>(<span class="ss">f&quot;Problem in the available file </span><span class="sc">{</span>place<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-18">        <span class="cf">return</span></span>
<span id="cb5-19"></span>
<span id="cb5-20">    nr <span class="op">=</span> <span class="bu">int</span>(GridsPerR <span class="op">*</span> rmax)</span>
<span id="cb5-21">    R, Z, taus, vel, taup, nz <span class="op">=</span> gettingfield(place, zmin, zmax, rmax, nr)</span>
<span id="cb5-22">    zminp, zmaxp, rminp, rmaxp <span class="op">=</span> Z.<span class="bu">min</span>(), Z.<span class="bu">max</span>(), R.<span class="bu">min</span>(), R.<span class="bu">max</span>()</span>
<span id="cb5-23"></span>
<span id="cb5-24">    <span class="co"># Plotting</span></span>
<span id="cb5-25">    AxesLabel, TickLabel <span class="op">=</span> <span class="dv">50</span>, <span class="dv">20</span></span>
<span id="cb5-26">    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb5-27">    fig.set_size_inches(<span class="fl">19.20</span>, <span class="fl">10.80</span>)</span>
<span id="cb5-28"></span>
<span id="cb5-29">    <span class="co"># Draw domain boundaries</span></span>
<span id="cb5-30">    ax.plot([<span class="dv">0</span>, <span class="dv">0</span>], [zmin, zmax], <span class="st">&#39;-.&#39;</span>, color<span class="op">=</span><span class="st">&#39;grey&#39;</span>, linewidth<span class="op">=</span>lw)</span>
<span id="cb5-31">    ax.plot([rmin, rmin], [zmin, zmax], <span class="st">&#39;-&#39;</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, linewidth<span class="op">=</span>lw)</span>
<span id="cb5-32">    ax.plot([rmin, rmax], [zmin, zmin], <span class="st">&#39;-&#39;</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, linewidth<span class="op">=</span>lw)</span>
<span id="cb5-33">    ax.plot([rmin, rmax], [zmax, zmax], <span class="st">&#39;-&#39;</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, linewidth<span class="op">=</span>lw)</span>
<span id="cb5-34">    ax.plot([rmax, rmax], [zmin, zmax], <span class="st">&#39;-&#39;</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, linewidth<span class="op">=</span>lw)</span>
<span id="cb5-35"></span>
<span id="cb5-36">    <span class="co"># Add fluid interfaces</span></span>
<span id="cb5-37">    line_segments <span class="op">=</span> LineCollection(segs2, linewidths<span class="op">=</span><span class="dv">4</span>, colors<span class="op">=</span><span class="st">&#39;green&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;solid&#39;</span>)</span>
<span id="cb5-38">    ax.add_collection(line_segments)</span>
<span id="cb5-39">    line_segments <span class="op">=</span> LineCollection(segs1, linewidths<span class="op">=</span><span class="dv">4</span>, colors<span class="op">=</span><span class="st">&#39;blue&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;solid&#39;</span>)</span>
<span id="cb5-40">    ax.add_collection(line_segments)</span>
<span id="cb5-41"></span>
<span id="cb5-42">    <span class="co"># Plot scalar fields with colormaps</span></span>
<span id="cb5-43">    cntrl1 <span class="op">=</span> ax.imshow(taus, cmap<span class="op">=</span><span class="st">&quot;hot_r&quot;</span>, interpolation<span class="op">=</span><span class="st">&#39;Bilinear&#39;</span>, origin<span class="op">=</span><span class="st">&#39;lower&#39;</span>, </span>
<span id="cb5-44">                      extent<span class="op">=</span>[<span class="op">-</span>rminp, <span class="op">-</span>rmaxp, zminp, zmaxp], vmax<span class="op">=</span><span class="fl">2.0</span>, vmin<span class="op">=-</span><span class="fl">3.0</span>)</span>
<span id="cb5-45"></span>
<span id="cb5-46">    <span class="co"># </span><span class="al">TODO</span><span class="co">: fixme the colorbar bounds for taup must be set manually based on the simulated case.</span></span>
<span id="cb5-47">    cntrl2 <span class="op">=</span> ax.imshow(taup, interpolation<span class="op">=</span><span class="st">&#39;Bilinear&#39;</span>, cmap<span class="op">=</span>custom_cmap, origin<span class="op">=</span><span class="st">&#39;lower&#39;</span>, </span>
<span id="cb5-48">                      extent<span class="op">=</span>[rminp, rmaxp, zminp, zmaxp], vmax<span class="op">=</span><span class="fl">2.0</span>, vmin<span class="op">=-</span><span class="fl">3.0</span>)</span>
<span id="cb5-49"></span>
<span id="cb5-50">    <span class="co"># Set plot properties</span></span>
<span id="cb5-51">    ax.set_aspect(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb5-52">    ax.set_xlim(rmin, rmax)</span>
<span id="cb5-53">    ax.set_ylim(zmin, zmax)</span>
<span id="cb5-54">    ax.set_title(<span class="ss">f&#39;$t/</span><span class="ch">\\</span><span class="ss">tau_</span><span class="ch">\\</span><span class="ss">gamma$ = </span><span class="sc">{</span>t<span class="sc">:4.3f}</span><span class="ss">&#39;</span>, fontsize<span class="op">=</span>TickLabel)</span>
<span id="cb5-55"></span>
<span id="cb5-56">    <span class="co"># Add colorbars</span></span>
<span id="cb5-57">    l, b, w, h <span class="op">=</span> ax.get_position().bounds</span>
<span id="cb5-58">    <span class="co"># Left colorbar</span></span>
<span id="cb5-59">    cb1 <span class="op">=</span> fig.add_axes([l<span class="op">-</span><span class="fl">0.04</span>, b, <span class="fl">0.03</span>, h])</span>
<span id="cb5-60">    c1 <span class="op">=</span> plt.colorbar(cntrl1, cax<span class="op">=</span>cb1, orientation<span class="op">=</span><span class="st">&#39;vertical&#39;</span>)</span>
<span id="cb5-61">    c1.set_label(<span class="vs">r&#39;</span><span class="dv">$</span><span class="er">\</span><span class="vs">log_</span><span class="op">{10}</span><span class="er">\</span><span class="vs">left</span><span class="kw">(</span><span class="ch">\|</span><span class="dv">\m</span><span class="vs">athcal{D}</span><span class="ch">\|\r</span><span class="vs">ight</span><span class="kw">)</span><span class="dv">$</span><span class="vs">&#39;</span>, fontsize<span class="op">=</span>TickLabel, labelpad<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb5-62">    c1.ax.tick_params(labelsize<span class="op">=</span>TickLabel)</span>
<span id="cb5-63">    c1.ax.yaxis.set_ticks_position(<span class="st">&#39;left&#39;</span>)</span>
<span id="cb5-64">    c1.ax.yaxis.set_label_position(<span class="st">&#39;left&#39;</span>)</span>
<span id="cb5-65">    c1.ax.yaxis.set_major_formatter(StrMethodFormatter(<span class="st">&#39;</span><span class="sc">{x:,.1f}</span><span class="st">&#39;</span>))</span>
<span id="cb5-66">    </span>
<span id="cb5-67">    <span class="co"># Right colorbar</span></span>
<span id="cb5-68">    cb2 <span class="op">=</span> fig.add_axes([l<span class="op">+</span>w<span class="op">+</span><span class="fl">0.01</span>, b, <span class="fl">0.03</span>, h])</span>
<span id="cb5-69">    c2 <span class="op">=</span> plt.colorbar(cntrl2, cax<span class="op">=</span>cb2, orientation<span class="op">=</span><span class="st">&#39;vertical&#39;</span>)</span>
<span id="cb5-70">    c2.ax.tick_params(labelsize<span class="op">=</span>TickLabel)</span>
<span id="cb5-71">    c2.set_label(<span class="vs">r&#39;</span><span class="dv">$</span><span class="er">\</span><span class="vs">log_</span><span class="op">{10}</span><span class="er">\</span><span class="vs">left</span><span class="kw">(</span><span class="ch">\t</span><span class="vs">ext{tr}</span><span class="er">\</span><span class="vs">left</span><span class="kw">(</span><span class="dv">\m</span><span class="vs">athcal{A}</span><span class="ch">\r</span><span class="vs">ight</span><span class="kw">)</span><span class="vs">-1</span><span class="ch">\r</span><span class="vs">ight</span><span class="kw">)</span><span class="dv">$</span><span class="vs">&#39;</span>, fontsize<span class="op">=</span>TickLabel)</span>
<span id="cb5-72">    c2.ax.yaxis.set_major_formatter(StrMethodFormatter(<span class="st">&#39;</span><span class="sc">{x:,.2f}</span><span class="st">&#39;</span>))</span>
<span id="cb5-73">    ax.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb5-74"></span>
<span id="cb5-75">    plt.savefig(name, bbox_inches<span class="op">=</span><span class="st">&quot;tight&quot;</span>)</span>
<span id="cb5-76">    plt.close()</span>
<span id="cb5-77"></span>
<span id="cb5-78"><span class="kw">def</span> main():</span></code></pre></div></div>
                <p>Main function that parses command-line arguments and
                parallelizes processing of timesteps.</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode python"><code class="sourceCode python"><span id="cb6-1">    <span class="co"># Set up command-line argument parsing</span></span>
<span id="cb6-2">    parser <span class="op">=</span> argparse.ArgumentParser(description<span class="op">=</span><span class="st">&#39;Process fluid dynamics simulation data and create visualizations&#39;</span>)</span>
<span id="cb6-3">    parser.add_argument(<span class="st">&#39;--CPUs&#39;</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span>mp.cpu_count(), </span>
<span id="cb6-4">                        <span class="bu">help</span><span class="op">=</span><span class="st">&#39;Number of CPUs to use (default: all available)&#39;</span>)</span>
<span id="cb6-5">    parser.add_argument(<span class="st">&#39;--nGFS&#39;</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">550</span>, </span>
<span id="cb6-6">                        <span class="bu">help</span><span class="op">=</span><span class="st">&#39;Number of restart files to process (default: 550)&#39;</span>)</span>
<span id="cb6-7">    parser.add_argument(<span class="st">&#39;--ZMAX&#39;</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>, default<span class="op">=</span><span class="fl">4.0</span>, </span>
<span id="cb6-8">                        <span class="bu">help</span><span class="op">=</span><span class="st">&#39;Maximum Z value (default: 4.0)&#39;</span>)</span>
<span id="cb6-9">    parser.add_argument(<span class="st">&#39;--RMAX&#39;</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>, default<span class="op">=</span><span class="fl">2.0</span>, </span>
<span id="cb6-10">                        <span class="bu">help</span><span class="op">=</span><span class="st">&#39;Maximum R value (default: 2.0)&#39;</span>)</span>
<span id="cb6-11">    parser.add_argument(<span class="st">&#39;--ZMIN&#39;</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>, default<span class="op">=-</span><span class="fl">4.0</span>, </span>
<span id="cb6-12">                        <span class="bu">help</span><span class="op">=</span><span class="st">&#39;Minimum Z value (default: -4.0)&#39;</span>)</span>
<span id="cb6-13">    parser.add_argument(<span class="st">&#39;--caseToProcess&#39;</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, </span>
<span id="cb6-14">                        default<span class="op">=</span><span class="st">&#39;../simulationCases/dropImpact&#39;</span>, </span>
<span id="cb6-15">                        <span class="bu">help</span><span class="op">=</span><span class="st">&#39;Case to process (default: ../simulationCases/dropImpact)&#39;</span>)  </span>
<span id="cb6-16">    parser.add_argument(<span class="st">&#39;--folderToSave&#39;</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, default<span class="op">=</span><span class="st">&#39;dropImpact&#39;</span>, </span>
<span id="cb6-17">                        <span class="bu">help</span><span class="op">=</span><span class="st">&#39;Folder to save output images (default: dropImpact)&#39;</span>)</span>
<span id="cb6-18">    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb6-19"></span>
<span id="cb6-20">    <span class="co"># Extract arguments</span></span>
<span id="cb6-21">    CPUStoUse <span class="op">=</span> args.CPUs</span>
<span id="cb6-22">    nGFS <span class="op">=</span> args.nGFS</span>
<span id="cb6-23">    ZMAX <span class="op">=</span> args.ZMAX</span>
<span id="cb6-24">    RMAX <span class="op">=</span> args.RMAX</span>
<span id="cb6-25">    ZMIN <span class="op">=</span> args.ZMIN</span>
<span id="cb6-26">    </span>
<span id="cb6-27">    num_processes <span class="op">=</span> CPUStoUse</span>
<span id="cb6-28">    rmin, rmax, zmin, zmax <span class="op">=</span> [<span class="op">-</span>RMAX, RMAX, ZMIN, ZMAX]</span>
<span id="cb6-29">    GridsPerR <span class="op">=</span> <span class="dv">128</span>  <span class="co"># Grid resolution parameter</span></span>
<span id="cb6-30"></span>
<span id="cb6-31">    lw <span class="op">=</span> <span class="dv">2</span>  <span class="co"># Line width for plot elements</span></span>
<span id="cb6-32">    folder <span class="op">=</span> args.folderToSave</span>
<span id="cb6-33">    caseToProcess <span class="op">=</span> args.caseToProcess</span>
<span id="cb6-34"></span>
<span id="cb6-35">    <span class="co"># Create output directory if it doesn&#39;t exist</span></span>
<span id="cb6-36">    <span class="cf">if</span> <span class="kw">not</span> os.path.isdir(folder):</span>
<span id="cb6-37">        os.makedirs(folder)</span>
<span id="cb6-38"></span>
<span id="cb6-39">    <span class="co"># Create a pool of worker processes for parallel processing</span></span>
<span id="cb6-40">    <span class="cf">with</span> mp.Pool(processes<span class="op">=</span>num_processes) <span class="im">as</span> pool:</span>
<span id="cb6-41">        <span class="co"># Create partial function with fixed arguments</span></span>
<span id="cb6-42">        process_func <span class="op">=</span> partial(process_timestep, </span>
<span id="cb6-43">                             folder<span class="op">=</span>folder, nGFS<span class="op">=</span>nGFS,</span>
<span id="cb6-44">                             GridsPerR<span class="op">=</span>GridsPerR, rmin<span class="op">=</span>rmin, rmax<span class="op">=</span>rmax, </span>
<span id="cb6-45">                             zmin<span class="op">=</span>zmin, zmax<span class="op">=</span>zmax, lw<span class="op">=</span>lw, caseToProcess<span class="op">=</span>caseToProcess)</span>
<span id="cb6-46">        <span class="co"># Map the process_func to all timesteps</span></span>
<span id="cb6-47">        pool.<span class="bu">map</span>(process_func, <span class="bu">range</span>(nGFS))</span>
<span id="cb6-48"></span>
<span id="cb6-49"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb6-50">    main()</span></code></pre></div></div>
            </div>
        </main>

        <footer class="site-footer">
            <div class="footer-left">
              <a href="http://basilisk.fr/sandbox/vatsal/" target="_blank">
                <img src="../assets/logos/logoBasilisk_TransparentBackground.png" alt="Basilisk C" class="footer-logo">
              </a>
              <a href="https://pof.tnw.utwente.nl/" target="_blank">
                <img src="../assets/logos/LogoPof_transparent_white.png" alt="Physics of Fluids" class="footer-logo pof-logo">
              </a>
              <a href="https://www.utwente.nl/" target="_blank">
                <img src="../assets/logos/UT_Logo_2400_Sta_White_EN.png" alt="University of Twente" class="footer-logo">
              </a>
              <a href="https://www.vatsalsanjay.com/" target="_blank">
                <img src="../assets/logos/Logo_Vatsal_v3_OutLine.png" alt="Vatsal Sanjay" class="footer-logo">
              </a>
            </div>
            <div class="footer-center">
              <p class="copyright-text">
                &copy; Copyright<br>
                CoMPhy Lab 2025
              </p>
            </div>
            <div class="footer-right">
              <a href="https://scholar.google.com/citations?user=tHb_qZoAAAAJ&hl=en" target="_blank" aria-label="Google Scholar Profile">
                <i class="ai ai-google-scholar" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://github.com/comphy-lab" target="_blank" aria-label="GitHub Organization">
                <i class="fa-brands fa-github" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://www.youtube.com/@CoMPhyLab" target="_blank" aria-label="YouTube Channel">
                <i class="fa-brands fa-youtube" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://x.com/VatsalSanjay" target="_blank" aria-label="X (Twitter) Profile">
                <i class="fa-brands fa-x-twitter" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://bsky.app/profile/comphy-lab.org" target="_blank" aria-label="Bluesky Profile">
                <i class="fa-brands fa-bluesky" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://github.com/comphy-lab/fiber" class="edit-link" aria-label="Edit this page on GitHub">
                <i class="fa-brands fa-github"></i> Edit this page
              </a>
            </div>
          </footer>
    </div>  

    <!-- Command Palette -->
    <div id="simple-command-palette" class="simple-command-palette" style="display: none;">
        <div class="simple-command-palette-backdrop"></div>
        <div class="simple-command-palette-modal">
            <input type="text" id="command-palette-input" placeholder="Type a command..." autocomplete="off">
            <div id="command-palette-results" class="command-palette-results"></div>
            <div class="command-palette-footer">
                <span class="command-palette-footer-item"><kbd>↑</kbd> <kbd>↓</kbd> to navigate</span>
                <span class="command-palette-footer-item"><kbd>enter</kbd> to select</span>
                <span class="command-palette-footer-item"><kbd>esc</kbd> to close</span>
            </div>
        </div>
    </div>


<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Add copy button to each code block container
    const codeBlocks = document.querySelectorAll('.code-block-container pre');
    codeBlocks.forEach(function(codeBlock, index) {
        // Create button element
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        button.setAttribute('aria-label', 'Copy code to clipboard');
        button.setAttribute('data-copy-state', 'copy');
        
        // Get the code block container (parent of the pre)
        const container = codeBlock.parentNode;
        
        // Add the button to the container
        container.appendChild(button);
        
        // Set up click event
        button.addEventListener('click', async function() {
            const codeText = codeBlock.textContent;
            
            try {
                // Try to use the modern clipboard API first
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(codeText);
                    updateButtonState(button, 'success');
                } else {
                    // Fall back to the deprecated execCommand method
                    const textarea = document.createElement('textarea');
                    textarea.value = codeText;
                    textarea.style.position = 'fixed';  // Prevent scrolling to the bottom
                    document.body.appendChild(textarea);
                    textarea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textarea);
                    
                    if (successful) {
                        updateButtonState(button, 'success');
                    } else {
                        updateButtonState(button, 'error');
                    }
                }
            } catch (err) {
                console.error('Copy failed:', err);
                updateButtonState(button, 'error');
            }
        });
    });
    
    // Function to update button state
    function updateButtonState(button, state) {
        if (state === 'success') {
            button.textContent = 'Copied!';
            button.classList.add('copied');
        } else if (state === 'error') {
            button.textContent = 'Error!';
            button.classList.add('error');
        }
        
        // Reset button state after 2 seconds
        setTimeout(function() {
            button.textContent = 'Copy';
            button.classList.remove('copied', 'error');
        }, 2000);
    }
});
</script>
        </body>
</html>
